<script>

let tumUrunler = [];
let aktifKullanici = null;
const SESSION_SURE = 30 * 60 * 1000; // 30 dk

window.onload = function() {
    const session = JSON.parse(localStorage.getItem("session"));
    if(session && Date.now() < session.expire) {
        aktifKullanici = session.user;
        appiAc();
    }
};

function girisYap() {

    fetch('data/kullanicilar.json')
    .then(r=>r.json())
    .then(users=>{
        
        if(!Array.isArray(users)) {
            alert("Kullanıcı dosyası hatalı.");
            return;
        }

        const sifre = document.getElementById("sifre").value;

        const bulunan = users.find(u => u.Hash === simpleHash(sifre));

        if(bulunan) {

            localStorage.setItem("session", JSON.stringify({
                user: bulunan.Email,
                expire: Date.now() + SESSION_SURE
            }));

            aktifKullanici = bulunan.Email;
            appiAc();

        } else {
            alert("Hatalı Şifre");
        }

    });

}

function appiAc() {
    document.getElementById('loginArea').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    veriyiGetir();
}

function simpleHash(str){
    let hash = 0;
    for(let i=0;i<str.length;i++){
        hash = (hash<<5)-hash+str.charCodeAt(i);
        hash |= 0;
    }
    return Math.abs(hash).toString(16);
}

async function veriyiGetir(){

    const r = await fetch('data/urunler.json?t='+Date.now());
    const json = await r.json();
    
    tumUrunler = json.data || [];

    document.getElementById("guncelleme").innerText =
        "Güncelleme: "+json.metadata.v;

    tabloyuCiz();
}

function tabloyuCiz(){

    const arama = document.getElementById("arama").value.toLowerCase();
    const tbody = document.querySelector("#urunTablosu tbody");
    tbody.innerHTML="";

    tumUrunler
    .filter(u=>{
        return (u.Kod+" "+(u.TicariKod||"")+" "+(u.Aciklama||""))
        .toLowerCase()
        .includes(arama);
    })
    .forEach(u=>{

        const tr = document.createElement("tr");
        if(parseInt(u.Stok)<=0) tr.classList.add("stok-yok");

        tr.innerHTML=`
        <td><b>${u.Kod}</b></td>
        <td>${u.TicariKod||''}</td>
        <td>${u.Stok||0}</td>
        <td>${para(u.DigerKartlar)}</td>
        <td>${para(u.T4AMW)}</td>
        <td>${para(u.TekCekim)}</td>
        <td class="nakit-fiyat">${para(u.Nakit)}</td>
        <td>${u.UrunGami||''}</td>
        <td style="font-size:11px">${u.Aciklama||''}</td>
        `;

        tbody.appendChild(tr);
    });
}

function para(v){
    if(!v || isNaN(v)) return "-";
    return Number(v).toLocaleString("tr-TR")+" ₺";
}

</script>


Makro Tam kod
Option Explicit

Const GITHUB_TOKEN As String = "ghp_TOKEN"
Const REPO_NAME As String = "AygunAVM/excel-json"

Public Sub JSON_Export_And_Push()

    Dim jsonStr As String
    jsonStr = ExportToJSON("URUNLER")
    
    GitHubPush jsonStr, "data/urunler.json"
    
    MsgBox "Başarılı! 60 saniye içinde yayında.", vbInformation

End Sub


Private Function ExportToJSON(sheetName As String) As String

    Dim ws As Worksheet: Set ws = ThisWorkbook.Sheets(sheetName)
    Dim lo As ListObject: Set lo = ws.ListObjects(1)
    Dim r As Long, c As Long
    Dim json As String
    
    json = "{""metadata"":{""v"":""" & Format(Now, "dd.mm.yyyy HH:mm:ss") & """},""data"":["
    
    For r = 1 To lo.DataBodyRange.Rows.Count
        
        json = json & "{"
        
        For c = 1 To lo.ListColumns.Count
            
            Dim colName As String
            colName = NormalizeHeader(lo.HeaderRowRange(1, c).Value)
            
            Dim cellValue As Variant
            cellValue = lo.DataBodyRange(r, c).Value
            
            json = json & """" & colName & """:" & FormatValue(cellValue)
            
            If c < lo.ListColumns.Count Then json = json & ","
            
        Next c
        
        json = json & "}"
        If r < lo.DataBodyRange.Rows.Count Then json = json & ","
        
    Next r
    
    ExportToJSON = json & "]}"
    
End Function


Private Function NormalizeHeader(h As String) As String
    
    Dim t As String
    t = LCase(h)
    
    If InStr(t, "ticari") > 0 Then NormalizeHeader = "TicariKod": Exit Function
    If InStr(t, "kod") > 0 And InStr(t, "ticari") = 0 Then NormalizeHeader = "Kod": Exit Function
    If InStr(t, "stok") > 0 Then NormalizeHeader = "Stok": Exit Function
    If InStr(t, "diger") > 0 Or InStr(t, "diğer") > 0 Then NormalizeHeader = "DigerKartlar": Exit Function
    If InStr(t, "4t") > 0 Then NormalizeHeader = "T4AMW": Exit Function
    If InStr(t, "tek") > 0 Then NormalizeHeader = "TekCekim": Exit Function
    If InStr(t, "nakit") > 0 Then NormalizeHeader = "Nakit": Exit Function
    If InStr(t, "gam") > 0 Then NormalizeHeader = "UrunGami": Exit Function
    If InStr(t, "acik") > 0 Or InStr(t, "açık") > 0 Then NormalizeHeader = "Aciklama": Exit Function
    
    NormalizeHeader = h
    
End Function


Private Function FormatValue(v As Variant) As String
    
    If IsNumeric(v) And v <> "" Then
        FormatValue = Replace(CStr(v), ",", ".")
    Else
        Dim s As String
        s = CStr(v)
        s = Replace(s, """", "'")
        s = Replace(s, vbCrLf, " ")
        FormatValue = """" & s & """"
    End If
    
End Function


Private Sub GitHubPush(content As String, repoPath As String)

    Dim http As Object: Set http = CreateObject("MSXML2.XMLHTTP")
    Dim url As String
    url = "https://api.github.com/repos/" & REPO_NAME & "/contents/" & repoPath
    
    http.Open "GET", url, False
    http.setRequestHeader "Authorization", "token " & GITHUB_TOKEN
    http.send
    
    Dim sha As String
    If http.Status = 200 Then
        sha = Split(Split(http.responseText, """sha"":""")(1), """")(0)
    End If
    
    Dim payload As String
    payload = "{""message"":""Auto Update"",""content"":""" & Base64Encode(content) & """,""branch"":""main"""
    
    If sha <> "" Then payload = payload & ",""sha"":""" & sha & """"
    
    payload = payload & "}"
    
    http.Open "PUT", url, False
    http.setRequestHeader "Authorization", "token " & GITHUB_TOKEN
    http.send payload

End Sub


Private Function Base64Encode(text As String) As String

    Dim arrData() As Byte
    arrData = StrConv(text, vbFromUnicode)
    
    Dim objXML As Object
    Dim objNode As Object
    
    Set objXML = CreateObject("MSXML2.DOMDocument")
    Set objNode = objXML.createElement("b64")
    
    objNode.DataType = "bin.base64"
    objNode.nodeTypedValue = arrData
    
    Base64Encode = Replace(objNode.text, vbLf, "")
    
End Function
