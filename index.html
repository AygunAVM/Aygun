<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Aygün AVM Fiyat Listesi</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007bff">

<style>
body{
    font-family: Arial, sans-serif;
    margin:0;
    padding:0;
}

.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:15px;
    background:#f5f5f5;
    border-bottom:1px solid #ddd;
}

#versiyon{
    font-weight:bold;
    color:#007bff;
}

h3{
    margin:0;
}

table{
    width:100%;
    border-collapse:collapse;
}

th, td{
    padding:8px;
    border:1px solid #ddd;
    text-align:left;
    font-size:14px;
}

th{
    background:#f0f0f0;
}
</style>
</head>
<body>

<div class="header">
    <span id="versiyon">Yükleniyor...</span>
    <h3>Aygün AVM Fiyat Listesi</h3>
</div>

<div style="padding:15px;">
    <table id="urunTable">
        <thead></thead>
        <tbody></tbody>
    </table>
</div>

<script>
const JSON_URL = "data/urunler.json?v=" + Date.now();

fetch(JSON_URL)
.then(res => res.json())
.then(data => {

    // Versiyon Yaz
    if(data.metadata && data.metadata.v){
        document.getElementById("versiyon").innerText = data.metadata.v;
    }

    // Tablo Oluştur
    const table = document.getElementById("urunTable");
    const thead = table.querySelector("thead");
    const tbody = table.querySelector("tbody");

    if(data.data && data.data.length > 0){

        // Header
        const headers = Object.keys(data.data[0]);
        let headerRow = "<tr>";
        headers.forEach(h => {
            headerRow += "<th>" + h + "</th>";
        });
        headerRow += "</tr>";
        thead.innerHTML = headerRow;

        // Body
        let rows = "";
        data.data.forEach(item => {
            rows += "<tr>";
            headers.forEach(h => {
                rows += "<td>" + (item[h] ?? "") + "</td>";
            });
            rows += "</tr>";
        });

        tbody.innerHTML = rows;
    }

})
.catch(err => {
    document.getElementById("versiyon").innerText = "Veri yüklenemedi";
    console.error(err);
});

// Service Worker
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
