<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aygün AVM | Fiyat Listesi</title>

<link rel="manifest" href="manifest.json">

<style>
body{margin:0;font-family:Arial,sans-serif;background:#f4f4f4}
header{background:#111;color:white;padding:15px;text-align:center;font-size:18px}
.controls{padding:10px;display:flex;gap:8px;flex-wrap:wrap}
#search{flex:1;padding:8px;font-size:14px}
#markaFilter{padding:8px;font-size:14px}
button{padding:8px;background:#007bff;color:white;border:none;border-radius:5px;cursor:pointer}
table{width:100%;border-collapse:collapse;background:white}
th,td{padding:8px;border-bottom:1px solid #ddd;font-size:13px}
th{background:#eee}
.version{font-size:11px;color:#777;text-align:center;margin-top:10px}
</style>
</head>

<body>

<header>Aygün AVM Fiyat Listesi</header>

<div class="controls">
<select id="markaFilter">
    <option value="">Tüm Markalar</option>
</select>
<input type="text" id="search" placeholder="Ürün ara...">
<button onclick="logout()">Çıkış</button>
<button onclick="changePwd()">Şifre Değiştir</button>
</div>

<table>
<thead><tr id="thead"></tr></thead>
<tbody id="tbody"></tbody>
</table>

<div class="version" id="version"></div>

<script>
let allData = [];

async function loadData(){
    try {
        const res = await fetch("data/urunler.json?v="+Date.now());
        const json = await res.json();
        allData = json.data || [];

        document.getElementById("version").innerText = "Versiyon: " + (json.metadata?.v||"");

        buildTable(allData);
        buildFilter(allData);

    } catch(e) {
        console.error(e);
    }
}

function buildTable(data){
    const thead = document.getElementById("thead");
    const tbody = document.getElementById("tbody");
    thead.innerHTML = ""; tbody.innerHTML = "";

    if(!data.length) return;

    Object.keys(data[0]).forEach(key => {
        const th = document.createElement("th");
        th.innerText = key;
        thead.appendChild(th);
    });

    data.forEach(row => {
        const tr = document.createElement("tr");
        Object.keys(row).forEach(key => {
            const td = document.createElement("td");
            td.innerText = row[key];
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
}

function buildFilter(data){
    const sel = document.getElementById("markaFilter");
    const brands = [...new Set(data.map(u=>u.Marka))].filter(x=>x);

    brands.sort().forEach(b=>{
        const opt = document.createElement("option");
        opt.value = b; opt.textContent = b;
        sel.appendChild(opt);
    });

    sel.onchange = filterTable;
    document.getElementById("search").oninput = filterTable;
}

function filterTable(){
    const text = document.getElementById("search").value.toLowerCase();
    const marka = document.getElementById("markaFilter").value;

    const filtered = allData.filter(u => {
        const matchesText = Object.values(u).join(" ").toLowerCase().includes(text);
        const matchesBrand = !marka || u.Marka===marka;
        return matchesText && matchesBrand;
    });

    buildTable(filtered);
}

function logout(){
  localStorage.clear();
  location.reload();
}
function changePwd(){
  alert("Şifre değiştirme ileride eklenecek.");
}

loadData();
</script>

</body>
</html>
